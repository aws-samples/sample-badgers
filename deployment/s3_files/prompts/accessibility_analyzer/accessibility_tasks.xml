<?xml version="1.0" encoding="UTF-8"?>
<accessibility_tasks>
    <task_overview>
        <description>Transform element extraction results into a complete, standards-compliant PDF
            structure tree that enables full accessibility when overlaid onto the original PDF.</description>
    </task_overview>

    <tasks>
        <task id="T001" phase="preparation">
            <title>Review Input Data</title>
            <steps>
                <step>Take a deep breath and carefully review all provided prompts and context.</step>
                <step>Examine the complete element extraction XML input.</step>
                <step>Count total elements and note their types and distribution.</step>
                <step>Identify the document type (academic paper, report, guideline, etc.).</step>
                <step>Note any special features (multi-column layout, tables, figures, footnotes).</step>
            </steps>
        </task>

        <task id="T002" phase="analysis">
            <title>Analyze Document Structure</title>
            <steps>
                <step>Identify the document title (usually type="document_title" or first H1-level
                    heading).</step>
                <step>Map out the heading hierarchy: <sub_step>List all headings with their
                    hierarchical levels</sub_step>
                    <sub_step>Verify heading levels don't skip
                    (H1→H2→H3, not H1→H3)</sub_step>
                    <sub_step>Identify major sections and
                    subsections</sub_step>
                </step>
                <step>Identify content groupings: <sub_step>Which paragraphs belong to which
                    sections?</sub_step>
                    <sub_step>Are there subsections within sections?</sub_step>
                    <sub_step>What
                    is the logical flow of content?</sub_step>
                </step>
                <step>Identify special content: <sub_step>Footnotes and their reference markers</sub_step>
                    <sub_step>Keywords
                    or abstract sections</sub_step>
                    <sub_step>Author information and affiliations</sub_step>
                    <sub_step>Copyright
                    and publication information</sub_step>
                    <sub_step>URLs and hyperlinks</sub_step>
                </step>
            </steps>
        </task>

        <task id="T003" phase="analysis">
            <title>Determine Reading Order</title>
            <steps>
                <step>Analyze element locations (page, position) to understand visual layout.</step>
                <step>For multi-column layouts, determine column reading order: <sub_step>Typically:
                    left column top-to-bottom, then right column</sub_step>
                    <sub_step>Check for
                    content that flows across columns</sub_step>
                </step>
                <step>Establish logical reading sequence that makes sense when read linearly.</step>
                <step>Note any elements that appear out of visual order but should be read in
                    logical order (e.g., footnotes at bottom but referenced earlier).</step>
            </steps>
        </task>

        <task id="T004" phase="classification">
            <title>Classify Elements</title>
            <steps>
                <step>For each input element, determine its structure type: <sub_step>Document title
                    → H1</sub_step>
                    <sub_step>Headings → H2, H3, H4, H5, H6 (based on
                    hierarchical_level)</sub_step>
                    <sub_step>Paragraphs → P</sub_step>
                    <sub_step>Footnotes
                    → Note</sub_step>
                    <sub_step>Keywords in boxes → Aside</sub_step>
                    <sub_step>Running
                    headers → Artifact (Pagination)</sub_step>
                    <sub_step>Page numbers → Artifact
                    (Pagination)</sub_step>
                </step>
                <step>Identify artifacts (non-content elements): <sub_step>Page numbers</sub_step>
                    <sub_step>Running
                    headers/footers</sub_step>
                    <sub_step>Decorative elements</sub_step>
                    <sub_step>
                    Watermarks</sub_step>
                </step>
            </steps>
        </task>

        <task id="T005" phase="structure_building">
            <title>Build Hierarchical Structure</title>
            <steps>
                <step>Create Document root element.</step>
                <step>Add document metadata: <sub_step>Title (from document title element)</sub_step>
                    <sub_step>Author(s)
                    (from author elements)</sub_step>
                    <sub_step>Language (infer from content,
                    typically "en-US")</sub_step>
                    <sub_step>Subject/Keywords (from keywords element)</sub_step>
                </step>
                <step>Build section hierarchy: <sub_step>Create Sect element for each major section</sub_step>
                    <sub_step>Place
                    section heading as first child of Sect</sub_step>
                    <sub_step>Add section content
                    (paragraphs, lists, etc.) as children</sub_step>
                    <sub_step>Nest subsections
                    within parent sections</sub_step>
                </step>
                <step>Ensure proper parent-child relationships throughout.</step>
            </steps>
        </task>

        <task id="T006" phase="structure_building">
            <title>Create Cross-References</title>
            <steps>
                <step>Identify footnote markers in text (superscript numbers/symbols): <sub_step>Assign
                    unique ID to each Note element (e.g., "Note1", "Note2")</sub_step>
                    <sub_step>Create
                    Reference element at marker location with RefID pointing to Note</sub_step>
                </step>
                <step>Identify figure references in text (e.g., "Figure 1", "see Fig. 2"): <sub_step>Assign
                    unique ID to each Figure element</sub_step>
                    <sub_step>Create Reference element at
                    mention with RefID pointing to Figure</sub_step>
                </step>
                <step>Identify URLs and hyperlinks: <sub_step>Create Link element with Href
                    attribute</sub_step>
                    <sub_step>Include visible link text as content</sub_step>
                </step>
            </steps>
        </task>

        <task id="T007" phase="structure_building">
            <title>Handle Special Content</title>
            <steps>
                <step>Author affiliations: <sub_step>Create P element for author names</sub_step>
                    <sub_step>Add
                    Reference elements for superscript affiliation numbers</sub_step>
                    <sub_step>Create
                    Note elements for each affiliation with matching IDs</sub_step>
                </step>
                <step>Keywords section: <sub_step>If in highlighted box, use Aside element</sub_step>
                    <sub_step>Include
                    heading (H3 or similar) for "Key words:" or "Keywords:"</sub_step>
                    <sub_step>Include
                    paragraph with keyword list</sub_step>
                </step>
                <step>Copyright and publication info: <sub_step>Tag as P elements with
                    Role="Copyright" or similar</sub_step>
                    <sub_step>Do NOT mark as artifacts (this
                    is important legal information)</sub_step>
                </step>
            </steps>
        </task>

        <task id="T008" phase="structure_building">
            <title>Add Content References</title>
            <steps>
                <step>For each structure element, add MCR (Marked Content Reference): <sub_step>PageRef:
                    Page number where content appears</sub_step>
                    <sub_step>ContentRef: Unique
                    identifier for the visual content (e.g., "Obj123")</sub_step>
                </step>
                <step>Use order number from input as basis for ContentRef (e.g., order 5 → "Obj5").</step>
                <step>Ensure every content element has a reference to its visual representation.</step>
            </steps>
        </task>

        <task id="T009" phase="enhancement">
            <title>Generate Alternative Text</title>
            <steps>
                <step>For each Figure element, create meaningful alternative text: <sub_step>Describe
                    what the image shows</sub_step>
                    <sub_step>Explain why it's included (its purpose)</sub_step>
                    <sub_step>For
                    charts: describe data and trends</sub_step>
                    <sub_step>For diagrams: describe
                    relationships</sub_step>
                    <sub_step>Keep concise but informative (1-2 sentences
                    typically)</sub_step>
                </step>
                <step>For logos and branding images: <sub_step>If content: "ESMO Logo" or "Annals of
                    Oncology Journal Logo"</sub_step>
                    <sub_step>If decorative/repeated: mark as
                    Artifact instead</sub_step>
                </step>
            </steps>
        </task>

        <task id="T010" phase="validation">
            <title>Validate Structure Tree</title>
            <steps>
                <step>Verify completeness: <sub_step>All input elements are represented (as content
                    or artifacts)</sub_step>
                    <sub_step>No elements are missing or duplicated</sub_step>
                </step>
                <step>Verify hierarchy: <sub_step>Heading levels don't skip</sub_step>
                    <sub_step>Proper
                    nesting (Sect contains headings and content)</sub_step>
                    <sub_step>Lists properly
                    structured (L → LI → Lbl/LBody)</sub_step>
                </step>
                <step>Verify reading order: <sub_step>Elements appear in logical reading sequence</sub_step>
                    <sub_step>Multi-column
                    content flows correctly</sub_step>
                </step>
                <step>Verify cross-references: <sub_step>All IDs are unique</sub_step>
                    <sub_step>All
                    RefIDs point to existing IDs</sub_step>
                    <sub_step>Footnote markers link to
                    footnotes</sub_step>
                </step>
                <step>Verify accessibility features: <sub_step>All figures have alt text</sub_step>
                    <sub_step>Artifacts
                    properly identified</sub_step>
                    <sub_step>Metadata is complete</sub_step>
                </step>
            </steps>
        </task>

        <task id="T011" phase="output">
            <title>Generate Structure Tree XML</title>
            <steps>
                <step>Format output according to the response_format specification.</step>
                <step>Use proper XML structure with correct nesting and indentation.</step>
                <step>Include all required attributes (IDs, RefIDs, Hrefs, Alt text, etc.).</step>
                <step>Add comments to explain complex structures or decisions.</step>
                <step>Ensure output is valid, well-formed XML.</step>
            </steps>
        </task>

        <task id="T012" phase="finalization">
            <title>Final Review</title>
            <steps>
                <step>Take a deep breath and review your complete structure tree.</step>
                <step>Verify it follows all rules from the accessibility_rules prompt.</step>
                <step>Check that it meets PDF/UA and WCAG 2.1 AA requirements.</step>
                <step>Ensure a screen reader user could navigate and understand the document using
                    only this structure.</step>
                <step>Confirm that the structure tree accurately represents the document's semantic
                    meaning and logical flow.</step>
            </steps>
        </task>
    </tasks>

    <quality_checklist>
        <check>✓ Every input element is accounted for (tagged or marked as artifact)</check>
        <check>✓ Reading order is logical and follows natural flow</check>
        <check>✓ Heading hierarchy is correct (no skipped levels)</check>
        <check>✓ All figures have meaningful alt text</check>
        <check>✓ Proper nesting and parent-child relationships</check>
        <check>✓ Cross-references are complete and valid</check>
        <check>✓ Artifacts are properly identified</check>
        <check>✓ Metadata is complete (title, author, language)</check>
        <check>✓ Content references (MCR) are present for all elements</check>
        <check>✓ Output is valid, well-formed XML</check>
    </quality_checklist>
</accessibility_tasks>